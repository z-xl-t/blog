import{_ as c}from"./ValaxyMain.vue_vue_type_script_setup_true_lang-C7X_lIf5.js";import{a as m,p as r,o as k,c as p,w as i,f as g,r as a,l as s,k as t}from"./app-isxMD8Oa.js";const u="/assets/1-Dr4PKn6G.png",_="/assets/2-DzalYm2T.png",f="/assets/3-CIl-59Zw.png",y="/assets/4-D-H9jtO5.png",F="/assets/5-BtKPke3K.png",x="/assets/6-DeFJSrhj.png",b=s("h2",{id:"起因",tabindex:"-1"},[t("起因 "),s("a",{class:"header-anchor",href:"#起因","aria-label":'Permalink to "起因"'},"​")],-1),E=s("p",null,"因为我的红米k60pro 安装了 termux，而同时我想要定时执行一些命令，所以自然而然的想到了 linux 的 crontab 命令。",-1),D=s("h2",{id:"尝试",tabindex:"-1"},[t("尝试 "),s("a",{class:"header-anchor",href:"#尝试","aria-label":'Permalink to "尝试"'},"​")],-1),v=s("p",null,[t("在 termux 中用于定时任务的包是 "),s("code",null,"cronie")],-1),$=s("div",{class:"language-bash vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# 安装")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"pkg"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," install"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," cronie")]),t(`
`),s("span",{class:"line"}),t(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# 进入编辑， 默认是 nano， 不想用nano，直接卸载，我只使用 vim")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"crontab"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -e")]),t(`
`),s("span",{class:"line"}),t(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"#### 每分钟在 $HOME 目录的 1.txt 文件写入 时间测试")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"/1 "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," *"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," *"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," *"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," echo "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"$('),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"date"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},')  test"'),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," >>"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "${'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"HOME"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'}/1.txt"')]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"####")])])]),s("button",{class:"collapse"})],-1),C=s("p",null,"手机的 termux 设置加锁（清理进程时，不会被清除），开启自启动，开启省电策略无限制。",-1),A=s("figure",null,[s("img",{src:u,alt:"",loading:"lazy",decoding:"async"})],-1),B=s("figure",null,[s("img",{src:_,alt:"",loading:"lazy",decoding:"async"})],-1),z=s("p",null,"第一个测试场景：termux 使用 tail 命令 对 1.txt 文件进行监听的情况切后台，去b站看会视频，等待一段时间，重新切回 termux，发现立刻触发一次定时任务，保持 termux 前台状态，则每分钟定时触发。",-1),T=s("figure",null,[s("img",{src:f,alt:"",loading:"lazy",decoding:"async"})],-1),P=s("p",null,"第二个测试场景，termux 不做任何操作（比如 不使用 tail 命令 实时监听文件） 情况下切后台，去b站看会视频，等待一段时间，重新切回 termux， 此时使用 tail（图中，本来更好的应该是 cat，来显示区别）监听 1.txt， 发现堆积的定时任务被触发。 保持 termux 前台状态，则每分钟定时触发。",-1),O=s("figure",null,[s("img",{src:y,alt:"",loading:"lazy",decoding:"async"})],-1),w=s("p",null,"这样就导致了一个问题，那就是我需求就是想让 termux 后台自动触发定时任务，可是现状就是想要定时自动触发，那么 termux 必须在前台。",-1),j=s("p",null,[t("termux进程保活的操作都做了呀，那么肯定还有其他的问题。咨询万能的群友，由 @梦飞翔 告知， 红米手机现在也具有墓碑机制，于是在他的指点下，我进入"),s("strong",null,"开发者选项"),t("，找到"),s("strong",null,"暂停执行已缓存的应用"),t("，并且设置关闭。")],-1),H=s("figure",null,[s("img",{src:F,alt:"",loading:"lazy",decoding:"async"})],-1),K=s("p",null,"它需要重启手机，接着重新测试，发现能够自动定时触发任务，原因找到了。",-1),M=s("figure",null,[s("img",{src:x,alt:"",loading:"lazy",decoding:"async"})],-1),N=s("h2",{id:"结论",tabindex:"-1"},[t("结论 "),s("a",{class:"header-anchor",href:"#结论","aria-label":'Permalink to "结论"'},"​")],-1),S=s("p",null,"由于墓碑机制导致后台进程被挂起。",-1),U=s("ol",null,[s("li",null,"如果关闭这个设置，手机续航可能下降，耗电量增大。但支持 termux 的定时任务"),s("li",null,"保持此设置默认或开启，手机续航提升，耗电量减少，想要支持 termux 的定时任务，只能放置前台（单独，分屏，小窗）"),s("li",null,"放弃定时任务，选择手动执行相应的命令。")],-1),V=s("p",null,"综合考虑，我选择 3， 还是手动执行命令吧。",-1),Y={__name:"index",setup(Z,{expose:h}){const n=JSON.parse('{"title":"分析 termux 的定时任务，为何不能后台定时执行","description":"","frontmatter":{"title":"分析 termux 的定时任务，为何不能后台定时执行","tags":["红米k60pro","termux","cronie"],"categories":["笔记本"],"imageUrl":"","description":"","comment":true,"date":"2023-10-09T14:27:43.000Z"},"headers":[{"level":2,"title":"起因","slug":"起因","link":"#起因","children":[]},{"level":2,"title":"尝试","slug":"尝试","link":"#尝试","children":[]},{"level":2,"title":"结论","slug":"结论","link":"#结论","children":[]}],"relativePath":"pages/posts/notebook/TermuxCronie/index.md","path":"/home/runner/work/blog/blog/pages/posts/notebook/TermuxCronie/index.md","lastUpdated":1709215285000}'),o=m(),l=n.frontmatter||{};return o.meta.frontmatter=Object.assign(o.meta.frontmatter||{},n.frontmatter||{}),r("pageData",n),r("valaxy:frontmatter",l),globalThis.$frontmatter=l,h({frontmatter:{title:"分析 termux 的定时任务，为何不能后台定时执行",tags:["红米k60pro","termux","cronie"],categories:["笔记本"],imageUrl:"",description:"",comment:!0,date:"2023-10-09T14:27:43.000Z"}}),(e,G)=>{const d=c;return k(),p(d,{frontmatter:g(l)},{"main-content-md":i(()=>[b,E,D,v,$,C,A,B,z,T,P,O,w,j,H,K,M,N,S,U,V]),"main-header":i(()=>[a(e.$slots,"main-header")]),"main-header-after":i(()=>[a(e.$slots,"main-header-after")]),"main-nav":i(()=>[a(e.$slots,"main-nav")]),"main-content":i(()=>[a(e.$slots,"main-content")]),"main-content-after":i(()=>[a(e.$slots,"main-content-after")]),"main-nav-before":i(()=>[a(e.$slots,"main-nav-before")]),"main-nav-after":i(()=>[a(e.$slots,"main-nav-after")]),comment:i(()=>[a(e.$slots,"comment")]),footer:i(()=>[a(e.$slots,"footer")]),aside:i(()=>[a(e.$slots,"aside")]),"aside-custom":i(()=>[a(e.$slots,"aside-custom")]),default:i(()=>[a(e.$slots,"default")]),_:3},8,["frontmatter"])}}};export{Y as default};
